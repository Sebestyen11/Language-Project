<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>World Language Tree</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
  margin:0;
  font-family:"Segoe UI", Arial, sans-serif;
  background: linear-gradient(135deg,#f3f7fa,#e0ebf5);
  overflow:hidden;
  user-select:none;
}
#tree-container { width:100vw; height:100vh; touch-action:none; cursor:grab; }
svg { width:100%; height:100%; }
#tree-group { transition: transform 0.05s linear; }
.node rect {
  fill:#fff; stroke:#5b9bd5; stroke-width:2; rx:8; ry:8;
  filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
}
.node:hover rect { fill:#e6f3ff; stroke:#0078d4; transform:scale(1.05); }
.node text { font-size:14px; font-weight:500; fill:#333; pointer-events:none; }
path.link { stroke:#a0bcd0; stroke-width:2; fill:none; }
.popup {
  position:fixed; top:50%; left:50%; transform:translate(-50%,-50%);
  background:#fff; border-radius:12px; padding:20px 25px;
  box-shadow:0 6px 20px rgba(0,0,0,0.25); display:none;
  z-index:1001; max-width:400px; text-align:center;
}
.popup h2 { margin-top:0; color:#0078d4; }
.popup p { color:#444; }
.popup .close {
  position:absolute; top:8px; right:12px;
  font-size:22px; font-weight:bold; color:#0078d4; cursor:pointer;
}
.overlay {
  position:fixed; top:0; left:0; width:100%; height:100%;
  background: rgba(0,0,0,0.4); display:none; z-index:1000;
}
</style>
</head>
<body>

<div id="tree-container">
  <svg id="tree-svg"><g id="tree-group"></g></svg>
</div>

<div class="overlay" id="overlay"></div>

<div class="popup" id="popup">
  <span class="close" id="closePopup">&times;</span>
  <h2 id="popupTitle"></h2>
  <p id="popupInfo"></p>
</div>

<script>
const overlay=document.getElementById("overlay");
const popup=document.getElementById("popup");
const popupTitle=document.getElementById("popupTitle");
const popupInfo=document.getElementById("popupInfo");
const closePopup=document.getElementById("closePopup");

function showPopup(title,info){ 
  popupTitle.textContent=title; 
  popupInfo.textContent=info; 
  popup.style.display="block"; 
  overlay.style.display="block"; 
}
function hidePopup(){ popup.style.display="none"; overlay.style.display="none"; }
closePopup.onclick=hidePopup; overlay.onclick=hidePopup;

const svg=document.getElementById("tree-svg");
const group=document.getElementById("tree-group");
let panX=0, panY=0, scale=1;
let dragging=false, startX, startY;

function updateTransform(){
  group.setAttribute("transform",`translate(${panX},${panY}) scale(${scale})`);
}

svg.addEventListener("wheel", e=>{
  if(popup.style.display==="block") return;
  e.preventDefault();
  const rect=svg.getBoundingClientRect();
  const cx=e.clientX-rect.left;
  const cy=e.clientY-rect.top;
  const factor=e.deltaY<0?1.05:0.95;
  panX-=(cx-panX)*(factor-1);
  panY-=(cy-panY)*(factor-1);
  scale*=factor;
  scale=Math.max(0.5,Math.min(scale,3));
  updateTransform();
});

svg.addEventListener("mousedown", e=>{
  if(popup.style.display==="block") return;
  dragging=true;
  startX=e.clientX-panX;
  startY=e.clientY-panY;
  svg.style.cursor="grabbing";
});
window.addEventListener("mousemove", e=>{
  if(dragging){ panX=e.clientX-startX; panY=e.clientY-startY; updateTransform(); }
});
window.addEventListener("mouseup", ()=>{
  dragging=false; svg.style.cursor="grab";
});

async function loadTree(){
  try{
    const res=await fetch("./languages.json");  // IMPORTANT: use ./ to ensure same folder
    const data=await res.json();
    buildTree(data);
    showPopup("Welcome to the Language Tree",
      "This tree shows global language families. Click a group to learn more. Drag to move, scroll to zoom.");
  }catch(err){
    console.error(err);
    showPopup("Error","Couldn't load languages.json. Make sure itâ€™s in the same folder as index.html!");
  }
}

function buildTree(data){
  group.innerHTML="";
  const nodes=[];
  const links=[];
  
  function traverse(node,x,y,depth,parent){
    nodes.push({...node,x,y,depth});
    if(parent) links.push({x1:parent.x,y1:parent.y,x2:x,y2:y});
    if(node.children){
      const step=200;
      node.children.forEach((child,i)=>{
        const childY=y+100;
        const offset=(i-(node.children.length-1)/2)*step;
        traverse(child,x+offset,childY,depth+1,node);
      });
    }
  }

  data.forEach((root,i)=>{
    traverse(root, (i*400)-200, 50, 0, null);
  });

  links.forEach(l=>{
    const path=document.createElementNS("http://www.w3.org/2000/svg","path");
    const mx=(l.x1+l.x2)/2;
    path.setAttribute("d",`M${l.x1},${l.y1} C${mx},${l.y1} ${mx},${l.y2} ${l.x2},${l.y2}`);
    path.setAttribute("class","link");
    group.appendChild(path);
  });

  nodes.forEach(n=>{
    const g=document.createElementNS("http://www.w3.org/2000/svg","g");
    g.setAttribute("class","node");
    g.setAttribute("transform",`translate(${n.x},${n.y})`);
    g.addEventListener("click",e=>{
      e.stopPropagation();
      showPopup(n.name,n.info||"No information available.");
    });
    const rect=document.createElementNS("http://www.w3.org/2000/svg","rect");
    rect.setAttribute("x",-70);
    rect.setAttribute("y",-25);
    rect.setAttribute("width",140);
    rect.setAttribute("height",50);
    const text=document.createElementNS("http://www.w3.org/2000/svg","text");
    text.setAttribute("text-anchor","middle");
    text.setAttribute("dy","5");
    text.textContent=n.name;
    g.appendChild(rect);
    g.appendChild(text);
    group.appendChild(g);
  });

  panX=window.innerWidth/2;
  panY=100;
  updateTransform();
}

loadTree();
</script>
</body>
</html>
